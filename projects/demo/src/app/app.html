<div class="demo-layout">
  <!-- Configuration Panel Toggle (Mobile) -->
  <button
    class="panel-toggle"
    (click)="toggleConfigPanel()"
    [attr.aria-expanded]="showConfigPanel()"
    aria-label="Toggle configuration panel">
    @if (showConfigPanel()) {
      <span>Hide Panel</span>
    } @else {
      <span>Show Panel</span>
    }
  </button>

  <!-- Configuration Panel -->
  @if (showConfigPanel()) {
    <aside class="config-panel">
      <h2>ngx-support-chat Demo</h2>

      <!-- Demo Scenarios -->
      <section class="config-section">
        <h3>Demo Scenarios</h3>
        <div class="button-group">
          <button
            type="button"
            [class.active]="activeScenario() === 'conversation'"
            (click)="loadScenario('conversation')">
            Conversation
          </button>
          <button
            type="button"
            [class.active]="activeScenario() === 'empty'"
            (click)="loadScenario('empty')">
            Empty
          </button>
          <button
            type="button"
            [class.active]="activeScenario() === 'all-types'"
            (click)="loadScenario('all-types')">
            All Types
          </button>
          <button
            type="button"
            [class.active]="activeScenario() === 'performance'"
            (click)="loadScenario('performance')">
            500+ Messages
          </button>
          <button
            type="button"
            [class.active]="activeScenario() === 'failed'"
            (click)="loadScenario('failed')">
            Failed Messages
          </button>
        </div>
      </section>

      <!-- Quick Replies Demo -->
      <section class="config-section">
        <h3>Quick Replies</h3>
        <div class="button-group">
          <button type="button" (click)="showQuickReplyDemo('confirmation')">
            Confirmation
          </button>
          <button type="button" (click)="showQuickReplyDemo('singleChoice')">
            Single Choice
          </button>
          <button type="button" (click)="showQuickReplyDemo('multipleChoice')">
            Multiple Choice
          </button>
        </div>
      </section>

      <!-- Container Size -->
      <section class="config-section">
        <h3>Container Size</h3>
        <div class="slider-control">
          <label>
            Width: {{ containerWidth() }}px
            <input
              type="range"
              min="280"
              max="800"
              step="10"
              [ngModel]="containerWidth()"
              (ngModelChange)="containerWidth.set($event)" />
          </label>
        </div>
        <div class="slider-control">
          <label>
            Height: {{ containerHeight() }}px
            <input
              type="range"
              min="400"
              max="800"
              step="10"
              [ngModel]="containerHeight()"
              (ngModelChange)="containerHeight.set($event)" />
          </label>
        </div>
        <p class="breakpoint-info">
          @if (containerWidth() < 300) {
            Breakpoint: <strong>Compact (&lt;300px)</strong>
          } @else if (containerWidth() < 600) {
            Breakpoint: <strong>Standard (300-600px)</strong>
          } @else {
            Breakpoint: <strong>Desktop (&gt;600px)</strong>
          }
        </p>
      </section>

      <!-- Theme Customization -->
      <section class="config-section">
        <h3>Theme Customization</h3>
        <div class="color-control">
          <label>
            User Bubble Color
            <div class="color-input-group">
              <input
                type="color"
                [ngModel]="userBubbleColor()"
                (ngModelChange)="userBubbleColor.set($event); applyUserBubbleColor()" />
              <span>{{ userBubbleColor() }}</span>
            </div>
          </label>
        </div>
        <div class="color-control">
          <label>
            Agent Bubble Color
            <div class="color-input-group">
              <input
                type="color"
                [ngModel]="agentBubbleColor()"
                (ngModelChange)="agentBubbleColor.set($event); applyAgentBubbleColor()" />
              <span>{{ agentBubbleColor() }}</span>
            </div>
          </label>
        </div>
        <button type="button" class="reset-btn" (click)="resetTheme()">
          Reset Theme
        </button>
      </section>

      <!-- Actions -->
      <section class="config-section">
        <h3>Test Actions</h3>
        <div class="button-group">
          <button type="button" (click)="triggerFailedMessage()">
            Send Failed Message
          </button>
        </div>
      </section>

      <!-- Event Log Toggle -->
      <section class="config-section">
        <button type="button" class="toggle-log-btn" (click)="toggleEventLog()">
          @if (showEventLog()) {
            Hide Event Log
          } @else {
            Show Event Log
          }
        </button>
      </section>

      <!-- Event Log -->
      @if (showEventLog()) {
        <section class="config-section event-log">
          <div class="log-header">
            <h3>Event Log</h3>
            <button type="button" class="clear-btn" (click)="clearEventLog()">Clear</button>
          </div>
          <div class="log-entries">
            @for (entry of eventLog(); track entry) {
              <div class="log-entry">{{ entry }}</div>
            } @empty {
              <div class="log-entry empty">No events yet</div>
            }
          </div>
        </section>
      }
    </aside>
  }

  <!-- Chat Demo Area -->
  <main class="chat-demo">
    <div
      class="chat-wrapper"
      [style.width.px]="containerWidth()"
      [style.height.px]="containerHeight()"
      [style]="containerStyles()">

      <ngx-chat-container
        [messages]="messages()"
        [typingIndicator]="typing()"
        [quickReplies]="quickReplies()"
        [currentUserId]="currentUserId"
        [pendingAttachments]="attachments()"
        [(inputValue)]="inputValue"
        (messageSend)="onMessageSend($event)"
        (messageRetry)="onMessageRetry($event)"
        (attachmentSelect)="onAttachmentSelect($event)"
        (attachmentRemove)="onAttachmentRemove($event)"
        (quickReplySubmit)="onQuickReplySubmit($event)"
        (imagePreview)="onImagePreview($event)"
        (fileDownload)="onFileDownload($event)"
        (scrollTop)="onScrollTop()">

        <!-- Custom Header -->
        <div chatHeader class="demo-header">
          <img [src]="agent().avatar" alt="Agent avatar" class="agent-avatar" />
          <div class="agent-info">
            <span class="agent-name">{{ agent().name }}</span>
            <span class="agent-status" [class.online]="agent().status === 'Online'">
              {{ agent().status }}
            </span>
          </div>
          <button type="button" class="close-btn" aria-label="Close chat">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <!-- Custom Empty State -->
        <div chatEmptyState class="demo-empty">
          <div class="empty-icon">ðŸ’¬</div>
          <h3>Welcome to Support Chat</h3>
          <p>Start a conversation with our team!</p>
        </div>

      </ngx-chat-container>
    </div>
  </main>
</div>
